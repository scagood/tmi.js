var twitchIRC=function(a,b,c){"use strict";function l(a,b,c){return c=c||"0",a+="",a.length>=b?a:new Array(b-a.length+1).join(c)+a}function m(a,b){g[a]||(g[a]=[]),g[a].push(b)}function n(a,b){var c;if(g[a])for(c in g[a])g[a][c].apply(null,Array.prototype.slice.call(arguments,1))}function o(a,b){d==a&&console.log.apply(null,[].slice.call(arguments,1))}function p(a){h.send(a),o(2,a)}function q(a){a=a.trim(),"#"!==a.substr(0,1)&&(a="#"+a),p("JOIN "+a)}function r(a){a=a.trim(),"#"!==a.substr(0,1)&&(a="#"+a),p("PART "+a)}function s(a,b){a=a.trim(),"#"!==a.substr(0,1)&&(a="#"+a),p("PRIVMSG "+a+" :"+b)}function t(a,b){a=a.trim(),p("PRIVMSG #jtv :/w "+a+" "+b)}b=":"===b[5]?b:"oauth:"+b,c=c||[];var h,d=c.debug||!1,e=c.relay||!1,f=c.channels||[],g={},i=this;if(!("WebSocket"in window))throw{name:"Web Sockets Unsupported",message:"Your browser does not support web sockets! Please update your browser!"};h="string"==typeof e?new WebSocket(e):new WebSocket("ws://irc-ws.chat.twitch.tv/"),h.onopen=function(){var c;p("PASS "+b),p("NICK "+a),p("CAP LS");for(c in f)f.hasOwnProperty(c)&&q(f[c])},h.onmessage=function(a){var c,d,e,f,g,h,j,k,b=a.data,b=b.trim().split("\n");for(c in b)if({}.hasOwnProperty.call(b,c)){if(n("raw",b[c].trim()),null!==(e=/(?:@([^ ]*) )?:([a-zA-z0-9!@_.]+) ([A-Z0-9]+) ([^ \r\n]+)(?:(?: :)?(.*))?/g.exec(b[c].trim()))){if(f={host:e[2],command:e[3],channel:e[4],raw:b[c].trim()},void 0!==e[5]&&(/\u0001ACTION (.*)\u0001/.test(e[5])?(f.action=!0,f.message=/\u0001ACTION (.*)\u0001/.exec(e[5])[1]):(f.action=!1,f.message=e[5])),void 0!==e[1]){g={},e[1]=e[1].split(";");for(c in e[1])e[1].hasOwnProperty(c)&&(e[1][c]=e[1][c].split("="),g[e[1][c][0]]=e[1][c][1]);if(f.tags=g,void 0!==g.badges&&""!==g.badges&&(g.badgesArray=g.badges.split("/").join("-").split(",")),void 0!==g.emotes&&""!=g.emotes){j=g.emotes.split("/"),k=[],d=0;for(c in j)if(j.hasOwnProperty(c)){h=j[c].split(":"),h[1]=h[1].split(",");for(c in h[1])h[1].hasOwnProperty(c)&&(h[1][c]=h[1][c].split("-"),h[1][c][0]=parseInt(h[1][c][0],10),h[1][c][1]=parseInt(h[1][c][1],10),d++);k[k.length]={name:f.message.substring(h[1][0][0],h[1][0][1]+1),location:h[1],emoteId:h[0]}}f.tags.emotesArray=k,f.tags.emotesArray.count=d}}f.time=(new Date).getTime(),/(?:(.+)!\1@\1\.)tmi.twitch.tv/.test(f.host)&&(f.user=/(?:(.+)!\1@\1\.)tmi.twitch.tv/.exec(f.host)[1])}else"PING :tmi.twitch.tv"===b[c].trim()?(p("PONG :tmi.twitch.tv"),f={command:"PING",message:"tmi.twitch.tv"}):f=b[c];"JOIN"===f.command?(delete f.action,o(1,"User joined:",f.channel,f.user),n("join",f.channel,f.user),-1==i.connected.indexOf(f.channel)&&i.connected.push(f.channel)):"PART"===f.command?(delete f.action,o(1,"User left:",f.channel,f.user),n("part",f.channel,f.user),i.connected.splice(i.connected.indexOf(f.channel),1)):"CAP"===f.command?(delete f.action,delete f.channel,f.command+=" * "+f.message.split(":")[0].trim(" "),f.message=f.message.split(":")[1],f.capibilities=f.message.split(" "),"CAP * LS"===f.command?(p("CAP REQ :"+f.message),o(1,"Available Capabilities:",f.message)):"CAP * NAK"===f.command?o(1,"Denied Capabilities:",f.message):"CAP * ACK"===f.command&&o(1,"Accepted Capabilities:",f.message)):"MODE"===f.command?(delete f.action,f.user=f.message.trim().split(" ")[1],f.message=f.message.trim().split(" ")[0],o(1,"Mode:",f.channel,f.user,f.message),n("mode",f.channel,f.user,f.message)):"ROOMSTATE"===f.command&&!0!==f.channel?(delete f.action,o(1,"roomstate:",f.channel,f.tags),n("roomstate",f.channel,f.tags)):"USERSTATE"===f.command&&!0!==f.channel?(delete f.action,o(1,"userstate:",f.channel,f.tags),n("userstate",f.channel,f.tags)):"PRIVMSG"===f.command&&!0!==f.action?(delete f.action,o(1,"message",f.channel,f.user,":"+f.message),n("message",f.channel,f.user,f.message,f.tags)):"CLEARCHAT"===f.command?f.message?f.tags["ban-duration"]?(o(1,"Timed:",f.channel,":"+f.message,"-",f.tags["ban-duration"]),n("usertimed",f.channel,f.message,f.tags["ban-duration"],f.tags)):(o(1,"Banned:",f.channel,":"+f.message),n("userban",f.channel,f.message,f.tags)):(o(1,"clearchat",f.channel),n("clearchat",f.channel)):"PRIVMSG"===f.command&&!0===f.action?(o(1,"action",f.channel,f.user,":"+f.message),n("action",f.channel,f.user,f.message,f.tags)):"WHISPER"===f.command?(delete f.action,o(1,"whisper",f.channel,f.user,":"+f.message),n("whisper",f.channel,f.user,f.message,f.tags)):"ERROR"===f.command?(delete f.action,o(1,"relayerror",f.channel,":"+f.message),n("relayerror",f.channel,f.message)):"BOTNICK"===f.command?(i.username=f.channel,o(1,"botnick",f.channel),n("botnick",f.channel)):"NOTICE"===f.command?(delete f.action,o(1,"notice",f.channel,":"+f.message),n("notice",f.channel,f.message,f.tags)):f.command===l(parseInt(f.command,10),3)&&(delete f.action,o(1,"Welcome:",f.command,":"+f.message),n("welcome",f.command,f.message)),o(2,f),n("all",f)}},h.onclose=function(){n("close")},this.username=a,this.connected=[],this.sendRaw=p,this.send=s,this.whisper=t,this.join=q,this.part=r,this.on=m,this.close=(()=>{h.close()})};
